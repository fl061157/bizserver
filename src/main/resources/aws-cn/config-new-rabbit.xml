<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

        <bean id="cnRabbitProperties_1" class="com.handwin.mq.RabbitProperties">
            <property name="userName" value="${cn1.rabbit.username}"></property>
            <property name="password" value="${cn1.rabbit.password}"></property>
            <property name="addresses" value="${cn1.rabbit.host}"></property>
        </bean>

        <bean id="cnRabbitProperties_2" class="com.handwin.mq.RabbitProperties">
            <property name="userName" value="${cn2.rabbit.username}"></property>
            <property name="password" value="${cn2.rabbit.password}"></property>
            <property name="addresses" value="${cn2.rabbit.host}"></property>
        </bean>

        <bean id="usRabbitProperties" class="com.handwin.mq.RabbitProperties">
            <property name="userName" value="${us.rabbit.username}"></property>
            <property name="password" value="${us.rabbit.password}"></property>
            <property name="addresses" value="${us.rabbit.host}"></property>
        </bean>

        <util:list id="cnPublishList">
           <ref bean="cnRabbitProperties_1"/>
           <ref bean="cnRabbitProperties_2"/>
        </util:list>

        <util:list id="usPublishList">
            <ref bean="usRabbitProperties"/>
        </util:list>

        <util:map id="pubRabbitProperties">
            <entry key="0086" value-ref="cnPublishList" />
            <entry key="0001" value-ref="usPublishList" />
        </util:map>

        <bean id="pubRabbitAdmin" class="com.handwin.mq.RabbitAdmin">
            <property name="pubRegionPropertiesMap" ref="pubRabbitProperties"></property>
        </bean>

        <bean id="tcpSubRabbitAdmin_1" class="com.handwin.mq.RabbitAdmin">
            <property name="subRegionProperties" ref="cnRabbitProperties_1"></property>
        </bean>

        <bean id="bizSubRabbitAdmin_1" class="com.handwin.mq.RabbitAdmin">
            <property name="subRegionProperties" ref="cnRabbitProperties_1"></property>
        </bean>


        <bean id="tcpSubRabbitAdmin_2" class="com.handwin.mq.RabbitAdmin">
            <property name="subRegionProperties" ref="cnRabbitProperties_2"></property>
        </bean>

        <bean id="bizSubRabbitAdmin_2" class="com.handwin.mq.RabbitAdmin">
            <property name="subRegionProperties" ref="cnRabbitProperties_2"></property>
        </bean>


        <bean id="tcpMessageListener" class="com.handwin.rabbitmq.TcpMessageHandler"/>
        <bean id="wrongMessageListener" class="com.handwin.rabbitmq.WrongMessageListener" />
        <bean id="serverHeartListener" class="com.handwin.rabbitmq.ServerHeartbeatListener" />
        <bean id="timerMessageListener" class="com.handwin.rabbitmq.TimerMessageListener" />
        <bean id="messageFromCoreServerHandler" class="com.handwin.rabbitmq.MessageFromCoreServerHandler"/>

        <bean id="v5ProtocolHandler" class="com.handwin.rabbitmq.V5ProtocolHandler" />


        <util:map id="listenerMapper" value-type="com.handwin.mq.MessageListener">
            <entry key="${http2biz.queue}" value-ref="messageFromCoreServerHandler" />
            <entry key="${biz2biz.queue}" value-ref="tcpMessageListener" />
            <entry key="${serverheart.queue}" value-ref="serverHeartListener" />
            <entry key="${fail.queue}" value-ref="wrongMessageListener" />
            <entry key="${timer2biz.queue}" value-ref="timerMessageListener" />
            <entry key="${v5protocol.queue}" value-ref="v5ProtocolHandler" />
        </util:map>

        <util:map id="tcpListenerMapper" value-type="com.handwin.mq.MessageListener">
            <entry key="${tcp2login.queue}"  value-ref="tcpMessageListener"  />
        </util:map>


        <bean id="tcpRabbitListenerContainer_1" class="com.handwin.mq.RabbitListenerContainer" >
            <property name="listenerMap" ref="tcpListenerMapper" />
            <property name="rabbitAdmin" ref="tcpSubRabbitAdmin_1" />
        </bean>

        <bean id="bizRabbitListenerContainer_1" class="com.handwin.mq.RabbitListenerContainer" >
            <property name="listenerMap" ref="listenerMapper" />
            <property name="rabbitAdmin" ref="bizSubRabbitAdmin_1" />
        </bean>

        <bean id="tcpRabbitListenerContainer_2" class="com.handwin.mq.RabbitListenerContainer" >
            <property name="listenerMap" ref="tcpListenerMapper" />
            <property name="rabbitAdmin" ref="tcpSubRabbitAdmin_2" />
        </bean>

        <bean id="bizRabbitListenerContainer_2" class="com.handwin.mq.RabbitListenerContainer" >
            <property name="listenerMap" ref="listenerMapper" />
            <property name="rabbitAdmin" ref="bizSubRabbitAdmin_2" />
        </bean>



       <bean id="cnRabbitTemplate" class="com.handwin.mq.RabbitTemplate">
            <property name="region" value="0086" />
            <property name="rabbitAdmin" ref="pubRabbitAdmin" />
        </bean>

        <bean id="usRabbitTemplate" class="com.handwin.mq.RabbitTemplate">
            <property name="region" value="0001" />
            <property name="rabbitAdmin" ref="pubRabbitAdmin" />
        </bean>


        <util:map id="templateMapping" >
            <entry key="0086" value-ref="cnRabbitTemplate" ></entry>
            <entry key="0001" value-ref="usRabbitTemplate" ></entry>
        </util:map>

        <bean id="amqpProtocolOutputTemplate" class="com.handwin.rabbitmq.AmqpProtocolOutputTemplate">
            <property name="templates" ref="templateMapping" ></property>
            <property name="defaultCountryCode" value="${default.country.code}" />
            <property name="localCountryCode" value="${localidc.country.code}" />
        </bean>



</beans>